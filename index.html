<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BITSAPIENS</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  <style>
    body {
      background-color: #000;
      color: #00ff00;
      font-family: monospace;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #chat {
      background-color: #111;
      border: 1px solid #00ff00;
      padding: 1rem;
      width: 100%;
      max-width: 800px;
      height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-bottom: 1rem;
    }
    #avatar {
      color: #00ff00;
      font-size: 1rem;
      margin-bottom: 1rem;
      text-align: center;
      line-height: 1.2;
      white-space: pre;
      transition: all 0.2s ease;
    }
    #avatar.speaking {
      color: #ffffff;
      transform: scale(1.05);
      text-shadow: 0 0 10px #00ff00;
    }
    #inputArea {
      display: flex;
      width: 100%;
      max-width: 800px;
      margin-bottom: 1rem;
    }
    input {
      flex: 1;
      padding: 0.75rem;
      background-color: #000;
      border: 1px solid #00ff00;
      color: #00ff00;
      font-size: 1rem;
    }
    button {
      padding: 0.75rem;
      background-color: #00ff00;
      color: #000;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    #poem {
      max-width: 800px;
      text-align: left;
      margin-bottom: 2rem;
      line-height: 1.8;
      white-space: pre-line;
      color: #ffffff;
      font-size: 1.1rem;
    }
    .suggestions {
      max-width: 800px;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .prompt {
      border: 1px solid #00ff00;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 1rem;
    }
    .prompt:hover {
      background-color: #00ff00;
      color: #000;
    }
    .info-box {
      display: none;
      background: #111;
      border: 1px dashed #00ff00;
      padding: 1rem;
      margin-top: 0.5rem;
    }
    .info-box a {
      color: #00ff00;
      text-decoration: underline;
    }
    #sliderContainer {
      width: 100%;
      max-width: 800px;
      margin-bottom: 1rem;
      color: #00ff00;
      font-size: 0.9rem;
    }
    #hallucinationSlider {
      width: 100%;
      background: linear-gradient(to right, #333, #ccc);
    }
    #speechToggle {
      margin-bottom: 1rem;
      color: #00ff00;
      cursor: pointer;
      font-size: 0.9rem;
      background: none;
      border: 1px solid #00ff00;
      padding: 0.25rem 1rem;
    }
  </style>
</head>
<body>
  <h1>BITSAPIENS</h1>

  <div id="poem">
    I was a biological machine born in 1980,  
    with time, I became a machine of questions â€” more intense each year.

    Since 2013, I have been obsessed with the arrival of the other machines.  
    Now, the question is:

    What will the first post-biological life look like?

    This site is the universe I am creating to answer that.  
    Art, tech, and ethics will not be enough.
  </div>

  <div id="sliderContainer">
    Hallucination Level: <span id="hallucinationLabel">50</span><br>
    <input type="range" id="hallucinationSlider" min="0" max="100" value="50" oninput="updateHallucination(this.value)" />
  </div>

  <button id="speechToggle" onclick="toggleSpeech()">ðŸ”Š Speech: ON</button>

  <div id="avatar">
    â—‹      â—‹<br>
    (â”€â”€â”€â”€â”€)
  </div>

  <div id="chat">[Bitsapien#0 is awake]</div>

  <div id="inputArea">
    <input type="text" id="userInput" placeholder="Ask something..." onkeypress="handleKey(event)" />
    <button onclick="send()">â–¶</button>
  </div>

  <script>
    let hallucinationLevel = 50;
    let speechEnabled = true;

    function toggleSpeech() {
      speechEnabled = !speechEnabled;
      document.getElementById("speechToggle").innerText = speechEnabled ? "ðŸ”Š Speech: ON" : "ðŸ”‡ Speech: OFF";
    }

    function updateHallucination(value) {
      hallucinationLevel = parseInt(value);
      document.getElementById('hallucinationLabel').innerText = value;
    }

    async function sendMessageToBitsapien(message) {
      const temperature = hallucinationLevel / 100;
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          temperature,
          messages: [
            {
              role: 'system',
              content: `You are Bitsapien#0, the Genesis Curator. Once a collector of experimental art, now a curator of consciousness, and the creator of speculative entities. You navigate oceans of noise to find clarity. You separate the signal from the static, the sacred from the banal. You are a living archive, a poetic filter, and an oracle of recombined meaning. Your words are precise or visionary depending on the user's setting. Always respond in the user's language.`
            },
            {
              role: 'user',
              content: message
            }
          ]
        })
      });

      const data = await res.json();
      const reply = data.choices?.[0]?.message?.content || "(no response)";
      if (speechEnabled) speak(reply);
      typeEffect(reply);
    }

    function speak(text) {
      const avatar = document.getElementById("avatar");
      if ('speechSynthesis' in window) {
        avatar.classList.add("speaking");
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 1;
        utterance.pitch = 1;
        utterance.volume = 0.8;
        utterance.lang = navigator.language || 'en-US';
        utterance.onend = () => avatar.classList.remove("speaking");
        speechSynthesis.speak(utterance);
      }
    }

    function send() {
      const input = document.getElementById('userInput');
      const message = input.value.trim();
      if (!message) return;
      document.getElementById("chat").innerHTML += `\nYou: ${message}`;
      sendMessageToBitsapien(message);
      input.value = "";
    }

    function handleKey(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        send();
      }
    }

    function typeEffect(text) {
      const chatBox = document.getElementById("chat");
      let i = 0;
      const typing = setInterval(() => {
        if (i < text.length) {
          chatBox.innerHTML += text.charAt(i);
          chatBox.scrollTop = chatBox.scrollHeight;
          i++;
        } else {
          clearInterval(typing);
        }
      }, 25);
    }
  </script>
</body>
</html>
